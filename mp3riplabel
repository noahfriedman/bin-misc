#! /bin/sh
# $Id: mp3riplabel,v 1.3 1999/10/15 15:40:13 friedman Exp $

init ()
{
          ##############################
   album=''

          ##############################
  author=''

           ##############################
  comment=''

  year=
  genre=

  file_author=`acronymize "$author"`
  file_album=`acronymize "$album"`
}

file-template ()
{
  echo "track$1.cdda.mp3"
}

acronymize ()
{
  case "$*" in
    *" "* | *-* )
      echo "$*" \
         | sed -e "s/^/ /" \
               -e "s/ *\([^ ]\)[^ ]*/\1/g" \
               -e "y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/"
     ;;
    * ) echo "$*" ;;
  esac
}

filter ()
{
  echo "$*" \
   | sed -e "s/  / /g" \
         -e "s/ $//" \
         -e "y/[(_ /----/" \
         -e "s/[]):.'!?]//g"
}

label ()
{
  file=`file-template "$1"`
  title="$2"
  comment="${3-$comment}"

  touch -r "$file" .stamp

  mp3info -W "$file"
  mp3info -t "$title" \
          -l "$album" \
          -a "$author" \
          -c "$comment" \
          -y "$year" \
          -g "$genre" \
    "$file"

  touch -r .stamp "$file"
  rm -f .stamp
}

rename ()
{
  old=`file-template "$1"`
  title="$2"
  comment="${3-$comment}"

  new=`filter "$title" "$comment"`
  new="$file_author.$file_album-$1.$new.mp3"
  mv -v "$old" "$new"
}

doit ()
{
         ##############################   ##############################
  $1 01 "Example Title"                  "Example Comment"
}

init
doit label
doit rename

# eof

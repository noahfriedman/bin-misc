#!/bin/bash
# $Id: yemacs,v 1.10 2005/08/15 12:56:40 friedman Exp $

# Prevent emacs bugs from consing all memory and thrashing the system until
# linux decides to start nuking other processes for more space.
#ulimit -Sd 65535
#ulimit -Sd 262144

case `basename $0` in
  yemacs )
    builddirs="
       $HOME/src/emacs/build/current/src
       /export/src/emacs/build/current/src
    "
   ;;

  u2emacs )
    builddirs="
       $HOME/src/emacs/build/unicode2/current/src
       /export/src/emacs/build/unicode2/current/src
    "
   ;;
esac

progname=emacs
case $1 in
  -login ) progname=-emacs; shift ;;
  -attach )
    case $DISPLAY in
      '' ) exec gnuclient -batch -eval "(make-frame-on-tty \"`tty`\" \"$TERM\")" ;;
      *  ) exec gnuclient -batch -eval "(make-frame-on-display \"$DISPLAY\")" ;;
    esac ;;
esac

for dir in $builddirs; do
  if [ -d $dir -a -f $dir/emacs ]; then
    ydir=`cd $dir && /bin/pwd`
    case $progname in
      emacs )
        ts=`echo $ydir | sed -e 's=.*/\([^/]*\)/src$=\1='`
        progname="$progname ($ts)"
       ;;
    esac
    test -e "$ydir/$progname" || ln -s emacs "$ydir/$progname"

    YEMACS_EXECDIR=$ydir
    PATH=$ydir:$PATH
    export YEMACS_EXECDIR PATH

    exec -a "$progname" $ydir/emacs "$@"
  fi
done

exec emacs "$@"

# eof
